<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mariemâ€™s 12-Week Glow-Up Tracker + Organizer âœ¨</title>

<!-- PWA manifest and theme color -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#5a2a57" />

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  body {
    font-family: 'Poppins', sans-serif;
    background: #fff0f6;
    color: #5a2a57;
    margin: 0; padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    padding: 20px 10px;
    font-weight: 600;
    font-size: 1.8rem;
    text-align: center;
    letter-spacing: 0.05em;
  }
  /* --- Glow-Up Tracker Styles --- */
  .week-container {
    width: 95vw; max-width: 400px;
    background: linear-gradient(135deg, #fce4f2 0%, #f9d5e5 100%);
    margin-bottom: 15px;
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(90, 42, 87, 0.3);
    padding: 15px;
    display: flex; flex-direction: column; align-items: center;
    transition: box-shadow 0.3s ease, transform 0.3s ease;
  }
  .week-container:hover {
    box-shadow: 0 10px 20px rgba(90, 42, 87, 0.4);
    transform: translateY(-5px);
  }
  .week-title {
    font-weight: 600;
    font-size: 1.2rem;
    margin-bottom: 10px;
    text-align: center;
  }
  input[type="file"] {
    display: none;
  }
  label.upload-btn {
    background: #b85c9e;
    color: white;
    padding: 10px 20px;
    border-radius: 30px;
    cursor: pointer;
    user-select: none;
    margin-bottom: 10px;
    transition: background 0.3s ease, box-shadow 0.3s ease;
    letter-spacing: 0.05em;
  }
  label.upload-btn:hover,
  label.upload-btn:focus {
    background: #91397d;
    box-shadow: 0 0 8px 2px #b85c9e99;
    outline: none;
  }
  .save-week-btn {
    margin-left: 10px;
    background: #7a378b;
    color: white;
    border: none;
    padding: 6px 14px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: background 0.3s ease, box-shadow 0.3s ease;
    letter-spacing: 0.05em;
  }
  .save-week-btn:hover,
  .save-week-btn:focus {
    background: #5a2a57;
    box-shadow: 0 0 8px 2px #5a2a5799;
    outline: none;
  }
  img.preview {
    max-width: 100%;
    max-height: 250px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(90, 42, 87, 0.2);
    margin-bottom: 10px;
    object-fit: cover;
    opacity: 0;
    transition: opacity 0.5s ease;
  }
  img.preview[src]:not([src=""]) {
    opacity: 1;
  }
  textarea.quote {
    width: 100%;
    resize: none;
    border-radius: 10px;
    border: 1px solid #b85c9e;
    padding: 8px;
    font-size: 1rem;
    font-family: 'Poppins', sans-serif;
    color: #5a2a57;
    background: #fff0f6;
    transition: box-shadow 0.3s ease;
  }
  textarea.quote:focus {
    outline: none;
    box-shadow: 0 0 8px 2px #b85c9e99;
    border-color: #b85c9e;
  }
  .weight-input-container {
    margin-top: 8px;
    width: 100%;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .weight-input-container label {
    font-weight: 600;
    color: #5a2a57;
    min-width: 80px;
  }
  .weight-input-container input[type="number"] {
    flex-grow: 1;
    padding: 6px;
    border-radius: 8px;
    border: 1px solid #b85c9e;
    background: #fff0f6;
    color: #5a2a57;
    font-size: 1rem;
    transition: box-shadow 0.3s ease;
  }
  .weight-input-container input[type="number"]:focus {
    outline: none;
    box-shadow: 0 0 8px 2px #b85c9e99;
    border-color: #b85c9e;
  }
  .save-btn {
    background: #5a2a57;
    color: #fff0f6;
    padding: 12px 25px;
    font-weight: 600;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    margin: 20px 0 40px;
    transition: background 0.3s ease, box-shadow 0.3s ease;
    position: sticky;
    bottom: 10px;
    z-index: 10;
    letter-spacing: 0.05em;
  }
  .save-btn:hover,
  .save-btn:focus {
    background: #7d4977;
    box-shadow: 0 0 8px 2px #7d497799;
    outline: none;
  }
  .upload-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }

  /* --- Organizer Styles --- */
  .tab-container {
    width: 95vw; max-width: 400px;
    background: #f9d5e5;
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(90,42,87,0.3);
    margin-bottom: 30px;
    padding: 15px;
  }
  .tabs {
    display: flex;
    justify-content: space-around;
    margin-bottom: 10px;
  }
  .tab-button {
    flex-grow: 1;
    background: #b85c9e;
    border: none;
    color: white;
    font-weight: 600;
    padding: 10px 0;
    cursor: pointer;
    border-radius: 20px 20px 0 0;
    transition: background 0.3s ease;
    letter-spacing: 0.05em;
  }
  .tab-button:hover, .tab-button:focus {
    background: #91397d;
    outline: none;
  }
  .tab-button.active {
    background: #5a2a57;
  }
  .tab-content {
    background: #fff0f6;
    border-radius: 0 20px 20px 20px;
    padding: 10px;
    min-height: 200px;
    max-height: 300px;
    overflow-y: auto;
  }
  .list-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: white;
    border-radius: 10px;
    margin-bottom: 8px;
    padding: 8px 12px;
    box-shadow: 0 2px 5px rgba(90,42,87,0.1);
  }
  .list-item input[type="text"] {
    border: none;
    background: transparent;
    flex-grow: 1;
    font-size: 1rem;
    color: #5a2a57;
  }
  .list-item input[type="text"]:focus {
    outline: none;
  }
  .list-item button {
    background: transparent;
    border: none;
    color: #b85c9e;
    font-weight: 700;
    font-size: 1.2rem;
    cursor: pointer;
    user-select: none;
    transition: color 0.3s ease;
  }
  .list-item button:hover {
    color: #91397d;
  }
  .add-item-btn {
    width: 100%;
    background: #b85c9e;
    border: none;
    color: white;
    font-weight: 600;
    padding: 10px 0;
    border-radius: 20px;
    cursor: pointer;
    margin-top: 8px;
    letter-spacing: 0.05em;
    transition: background 0.3s ease;
  }
  .add-item-btn:hover, .add-item-btn:focus {
    background: #91397d;
    outline: none;
  }

  /* Floating Action Button */
  .fab {
    position: fixed;
    bottom: 80px; /* above save button */
    right: 20px;
    width: 56px;
    height: 56px;
    background: #b85c9e;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(90, 42, 87, 0.4);
    color: white;
    font-size: 28px;
    line-height: 56px;
    text-align: center;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s ease;
    z-index: 110;
  }
  .fab:hover, .fab:focus {
    background: #91397d;
    outline: none;
  }

  /* Force Refresh Button */
  #forceRefreshBtn {
    position: fixed;
    bottom: 150px;
    right: 20px;
    padding: 10px 15px;
    background: #b85c9e;
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    z-index: 120;
    font-weight: 600;
    letter-spacing: 0.05em;
  }
  #forceRefreshBtn:hover, #forceRefreshBtn:focus {
    background: #91397d;
    outline: none;
  }
</style>
</head>
<body>

<header>Mariemâ€™s 12-Week Endolift Glow-Up Tracker âœ¨</header>

<form id="trackerForm">
  <div id="weeksContainer"></div>

  <button type="button" class="save-btn" onclick="saveData()">Save All Progress ðŸ’¾</button>
</form>

<div class="tab-container" id="organizerContainer">
  <div class="tabs" role="tablist">
    <button class="tab-button active" role="tab" aria-selected="true" aria-controls="todoTab" id="todoTabBtn">To-Do</button>
    <button class="tab-button" role="tab" aria-selected="false" aria-controls="shoppingTab" id="shoppingTabBtn">Shopping</button>
    <button class="tab-button" role="tab" aria-selected="false" aria-controls="placesTab" id="placesTabBtn">Places to Go</button>
  </div>
  <div id="todoTab" class="tab-content" role="tabpanel" aria-labelledby="todoTabBtn"></div>
  <div id="shoppingTab" class="tab-content" role="tabpanel" aria-labelledby="shoppingTabBtn" hidden></div>
  <div id="placesTab" class="tab-content" role="tabpanel" aria-labelledby="placesTabBtn" hidden></div>
</div>

<div class="fab" id="fabOrganizer" title="Open Organizer">ðŸ“‹</div>
<button id="forceRefreshBtn" title="Force Reload Latest Version">Force Refresh ðŸ”„</button>

<footer>Keep shining, Mariem! ðŸ’–</footer>

<script>
  // === Glow-Up Tracker Logic ===
  const weeksContainer = document.getElementById('weeksContainer');
  const defaultQuotes = [
    "Every change begins with courage â€” your glow starts now.",
    "Renewed inside and out, your beauty is unfolding.",
    "Small steps, big transformation â€” keep shining.",
    "Healing is your superpower; embrace the process.",
    "Strength grows through every challenge you overcome.",
    "Confidence blooms with each passing week.",
    "Radiate beauty from your soul to your skin.",
    "Your journey is a masterpiece in progress.",
    "Patience fuels the best transformations.",
    "Glow isnâ€™t just skin deep â€” itâ€™s your spirit rising.",
    "Trust the process; your reflection will thank you.",
    "You are radiant, resilient, and unstoppable."
  ];
  function formatDate(date) {
    return date.toLocaleDateString(undefined, { day: 'numeric', month: 'short' });
  }
  function getWeekDateRange(startDate, weekNumber) {
    const start = new Date(startDate);
    start.setDate(start.getDate() + (weekNumber - 1) * 7);
    const end = new Date(start);
    end.setDate(end.getDate() + 6);
    return `${formatDate(start)} â€“ ${formatDate(end)}`;
  }
  for(let i=1; i<=12; i++) {
    const range = getWeekDateRange(new Date('2025-06-18'), i);
    const weekDiv = document.createElement('div');
    weekDiv.className = 'week-container';
    weekDiv.innerHTML = `
      <div class="week-title">Week ${i} (${range})</div>
      <div class="upload-row">
        <label class="upload-btn" for="photo${i}">Upload Photo ðŸ“¸</label>
        <input type="file" id="photo${i}" accept="image/*" onchange="previewImage(event, ${i})" />
        <button type="button" class="save-week-btn" onclick="saveWeek(${i})">Save This Week ðŸ’¾</button>
      </div>
      <img id="preview${i}" class="preview" src="" alt="No photo yet" style="display:none;" />
      <textarea class="quote" id="quote${i}" rows="2" placeholder="Write your motivational quote or use this:">${defaultQuotes[i-1]}</textarea>
      <div class="weight-input-container">
        <label for="weight${i}">Weight (kg):</label>
        <input type="number" id="weight${i}" min="20" max="300" step="0.1" />
      </div>
    `;
    weeksContainer.appendChild(weekDiv);
  }
  function previewImage(event, week) {
    const preview = document.getElementById('preview' + week);
    const file = event.target.files[0];
    if(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      }
      reader.readAsDataURL(file);
    } else {
      preview.src = '';
      preview.style.display = 'none';
    }
  }
  function saveWeek(week) {
    let data = JSON.parse(localStorage.getItem('mariemGlowUpData')) || [];
    const quoteInput = document.getElementById('quote' + week);
    const imgPreview = document.getElementById('preview' + week);
    const weightInput = document.getElementById('weight' + week);
    const imgSrc = imgPreview.src || '';
    const weightVal = weightInput.value.trim();
    const index = data.findIndex(d => d.week === week);
    const entry = { week: week, photo: imgSrc, quote: quoteInput.value, weight: weightVal };
    if (index > -1) data[index] = entry;
    else data.push(entry);
    localStorage.setItem('mariemGlowUpData', JSON.stringify(data));
    alert(`Week ${week} saved! ðŸ’¾`);
  }
  function saveData() {
    let data = [];
    for(let i=1; i<=12; i++) {
      const quoteInput = document.getElementById('quote' + i);
      const imgPreview = document.getElementById('preview' + i);
      const weightInput = document.getElementById('weight' + i);
      const imgSrc = imgPreview.src || '';
      const weightVal = weightInput.value.trim();
      data.push({
        week: i,
        photo: imgSrc,
        quote: quoteInput.value,
        weight: weightVal
      });
    }
    localStorage.setItem('mariemGlowUpData', JSON.stringify(data));
    alert('All progress saved! ðŸ’¾');
  }
  function loadData() {
    const saved = localStorage.getItem('mariemGlowUpData');
    if(saved) {
      const data = JSON.parse(saved);
      data.forEach(item => {
        if(item.photo) {
          const preview = document.getElementById('preview' + item.week);
          preview.src = item.photo;
          preview.style.display = 'block';
        }
        document.getElementById('quote' + item.week).value = item.quote || '';
        if(item.weight !== undefined) {
          document.getElementById('weight' + item.week).value = item.weight;
        }
      });
    }
  }
  loadData();

  // === Organizer Logic ===
  const organizerLists = {
    todo: [],
    shopping: [],
    places: []
  };
  function saveOrganizer() {
    localStorage.setItem('mariemOrganizerData', JSON.stringify(organizerLists));
  }
  function loadOrganizer() {
    const saved = localStorage.getItem('mariemOrganizerData');
    if(saved) {
      Object.assign(organizerLists, JSON.parse(saved));
    }
  }
  function renderList(listName) {
    const container = document.getElementById(listName + 'Tab');
    container.innerHTML = '';
    organizerLists[listName].forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'list-item';
      div.innerHTML = `
        <input type="text" value="${item}" data-index="${index}" data-list="${listName}" />
        <button aria-label="Delete item" data-index="${index}" data-list="${listName}">&times;</button>
      `;
      container.appendChild(div);
    });
    const addBtn = document.createElement('button');
    addBtn.className = 'add-item-btn';
    addBtn.textContent = '+ Add Item';
    addBtn.setAttribute('aria-label', 'Add new item to ' + listName);
    addBtn.onclick = () => {
      organizerLists[listName].push('');
      renderList(listName);
      saveOrganizer();
    };
    container.appendChild(addBtn);
    container.querySelectorAll('input[type="text"]').forEach(input => {
      input.oninput = (e) => {
        const idx = e.target.getAttribute('data-index');
        const list = e.target.getAttribute('data-list');
        organizerLists[list][idx] = e.target.value;
        saveOrganizer();
      };
    });
    container.querySelectorAll('button[data-index]').forEach(btn => {
      btn.onclick = (e) => {
        const idx = e.target.getAttribute('data-index');
        const list = e.target.getAttribute('data-list');
        organizerLists[list].splice(idx, 1);
        renderList(list);
        saveOrganizer();
      };
    });
  }
  function switchTab(e) {
    const buttons = document.querySelectorAll('.tab-button');
    const contents = document.querySelectorAll('.tab-content');
    buttons.forEach(btn => {
      btn.classList.remove('active');
      btn.setAttribute('aria-selected', 'false');
    });
    contents.forEach(content => content.hidden = true);
    e.target.classList.add('active');
    e.target.setAttribute('aria-selected', 'true');
    document.getElementById(e.target.getAttribute('aria-controls')).hidden = false;
  }
  document.querySelectorAll('.tab-button').forEach(btn => {
    btn.addEventListener('click', switchTab);
  });
  loadOrganizer();
  renderList('todo');
  renderList('shopping');
  renderList('places');

  // FAB organizer toggle logic with smooth auto-scroll
  const fab = document.getElementById('fabOrganizer');
  const organizer = document.getElementById('organizerContainer');
  fab.addEventListener('click', () => {
    if (organizer.style.display === 'none' || !organizer.style.display) {
      organizer.style.display = 'block';
      fab.textContent = 'âœ–'; // close icon
      organizer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } else {
      organizer.style.display = 'none';
      fab.textContent = 'ðŸ“‹'; // list icon
    }
  });
  // Initially hide organizer to save space
  organizer.style.display = 'none';

  // Force Refresh Button Logic
  document.getElementById('forceRefreshBtn').addEventListener('click', () => {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(reg => reg.unregister());
        alert('Service Worker unregistered. Reloading fresh page...');
        window.location.reload(true); // true forces reload from server in some browsers
      });
    } else {
      window.location.reload(true);
    }
  });
</script>

<!-- Register service worker for offline caching and update notification -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js').then(reg => {
      console.log('Service Worker registered');
      reg.addEventListener('updatefound', () => {
        const newWorker = reg.installing;
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            if (confirm('âœ¨ New version available! Refresh now to update your tracker?')) {
              window.location.reload();
            }
          }
        });
      });
    }).catch(err => {
      console.log('Service Worker registration failed:', err);
    });
  }
</script>

</body>
</html>
